# noname-PWA

> 无名杀是基于社区的开源、免费的三国杀客户/服务端。

无名杀的 “渐进式网络应用程序 (Progressive Web App)” 版本 —— [点击体验](https://raineggplant.github.io/noname) ！

[点击查看 PWA 版本的部署仓库](https://github.com/RainEggplant/noname)。

## 简介

本仓库基于 [无名杀网页版](https://github.com/libccy/noname) 构建了 PWA 版本。简言之，相比原网页版，PWA 技术使得无名杀能够借助浏览器轻松地进行**跨平台安装**，为用户提供接近原生应用的体验，可以做到**按需加载**、**离线运行**、**自动更新**等。当然，即使不安装到本地，用户**仍旧可以直接通过浏览器**进行游戏（即所谓的 "Progressive"）。有关 PWA 的详细介绍请参见 [维基百科](https://zh.wikipedia.org/wiki/渐进式网络应用程序)。

## 改动

为了添加 PWA 支持，主要针对原网页版做了如下改动：

1. 增加了 PWA 相关的配置文件与资源文件。
2. 由于 PWA 要求通过 HTTPS 提供服务，因此联机时默认采用 WSS 协议（默认端口 443），如需使用不安全的 WS 协议，则应明确指定协议（和端口），例如无名杀官方提供的联机大厅地址应写作：`ws://47.99.105.222:8080` 。
   - 注意：一般情况下，在使用 HTTPS 时 WS 协议会被浏览器安全策略阻止（除非连接的是本机地址）。如果您必须使用 WS 协议，请参考[此页面](allow_mixed_content.md)。
3. 针对 Android 设备，增加了 “连续两次返回键退出” 功能，避免误触退出游戏。
4. 将 ttf 字体替换为 woff2 格式，以减小文件体积。

## 游戏与安装

### A. 安装 PWA 到本地（支持离线游戏）

#### Windows / Linux / Mac / Android

推荐使用基于 Chromium 内核的浏览器（如 Chrome, 新版 Edge），移动设备请确保打开了浏览器创建桌面快捷方式的权限。访问无名杀的站点地址（Firefox 可能存在显示 bug），然后打开浏览器菜单，点击 “**安装应用**” （若只看到 “添加到主屏幕”，请**稍等一两分钟并刷新**，或者等待浏览器自动弹出安装请求）。

#### iOS

iOS 仅 Safari 浏览器可以安装 PWA，请访问无名杀的站点地址，点击分享按钮，将无名杀添加到主屏幕。

### B. 网页版

推荐使用基于 Chromium 内核的浏览器（如 Chrome, 新版 Edge），访问无名杀的站点地址即可开始游戏。

### 注意：

- 初次访问无名杀站点时可能会提示 “是否重置游戏”，移动设备会提示 “是否切换到触屏模式”，确认即可。
- Safari 用户如果要使用联机功能，请确保实验性功能中的 `NSURLSession WebSocket` 处于开启状态。

## FAQ

- > 多次弹窗提示 “游戏似乎未正常载入，是否重置游戏”

  因游戏文件体积较大，初次打开需要一定时间加载。此时同意即可，一般多刷新几次就能加载好了。

- > 连接官方提供的联机大厅时提示 “当前的安全策略不允许未经加密的 WebSocket 连接”。

  官方联机大厅采用的是未经加密的 WebSocket 连接，通常情况下浏览器会进行阻止。如果您必须连接这个地址，请参考[此页面](allow_mixed_content.md)。
